<html>
	<head>
		<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
		<link rel="manifest" href="/manifest.json">
		<script>
			$( document ).ready(function() {
			    if ('serviceWorker' in navigator) {
				navigator.serviceWorker.register('/service-worker.js', {})
				.then((reg) => {
				    // регистрация сработала
				    console.log('Registration succeeded. Scope is ' + reg.scope);
				}).catch((error) => {
				    // регистрация прошла неудачно
				    console.log('Registration failed with ' + error);
				});
			    }
			    else{
				console.log("No service worker.");
			    }
			})
        	</script>
		<style>
		.box {
			width: 100%;
			height: 300px;
			margin: 50px;
			background: black;
			color: white;
			float:left;
		}
		
		.seen {
			width: 100%;
			height: 300px;
			margin: 50px;
			background: green;
			color: white;
			float:left;
		}
		</style>
		
		
		
		<script>
		var ids;
		
		Element.prototype.appendBefore = function (element) {
			element.parentNode.insertBefore(this, element);
		}, false;
		
		
		const Observer = new IntersectionObserver((entries, imgObserver) => {
			entries.forEach(e => e.isIntersecting && onVisible(e.target) )
		},{ threshold: 0.5 });
		
		const onVisible = elm => {  // что делать с элементами которые в поле видимости
				elm.className = "seen";
				elm.replaceWith(elm.cloneNode(true));
				markAsRead(elm.textContent);  // выводим их в консоль
		}
		
		function init(){
			document.querySelectorAll('.box').forEach(e => Observer.observe(e) );
		}
		
		function loadPrevious(){
		}
		
		function markAsRead(id){
			console.log(id);
		}
		
		function sendMessage(){
			var textArea = document.querySelector('#message');
			
			console.log(textArea.value);
			
			var newMessage = document.createElement("div");
			newMessage.className = "seen";
			newMessage.appendBefore(textArea);
			newMessage.textContent = textArea.value;
			textArea.value = "";
		}
		
		document.addEventListener("DOMContentLoaded", function(event) {
			init();
			
			var button = document.querySelector('#submit');
		
			button.addEventListener("click", function(event){
				console.log("Click!");
				sendMessage();
			});
		});
			
		</script>
	</head>
	<body>
		<div style = "float:left; border:1px;">
			<div>
				<div class="box">1</div>
				<div class="box">2</div>
				<div class="box">3</div>
				<div class="box">4</div>
				<div class="box">5</div>
				<div class="box">6</div>
				<div class="box">7</div>
				<div class="box">8</div>
				<div class="box">9</div>
				<div class="box">10</div>
				<div class="box">11</div>
				<div class="box">12</div>
				<div class="box">13</div>
				<div class="box">14</div>
				<div class="box">15</div>
				<div class="box">16</div>
				<div class="box">17</div>
				<div class="box">18</div>
				<div class="box">19</div>
				<div class="box">20</div>
				
				<textarea id="message"></textarea>
				<button id = "submit">Отправить</button>
			</div>
		</div>
	</body>
</html>
